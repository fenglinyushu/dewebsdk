# DeWeb常见问题 FAQ

##系统开发  
### Q：目前每个应用都是单独的DLL  如果想做一套完整的系统，应该怎样办？
**A**：可以做成多个模块，通过url和cookie交互，形成一个大系统；  
也可以把多个窗体集成在一起，可以参考dwms或dwFrame

### Q：如何修改页面标题 ？
**A**：修改Form1的caption即可

### Q：如何关闭当前页面？
**A**：执行以下代码，可以关闭当前页面
```pascal
//在Edge/Chrome/FireFox下测试通过  
dwRunJs(' window.open("about:blank","_self").close();' ,self); 
```
### Q：如何取客户端ip和mac？
**A**：可以通过以下代码取得ip。需要Form1的OnMouseUp中有代码，一行空注释也可以
```pascal
sIp := dwGetProp(Self,'ip');
```
不支持取得客户端mac

### Q：如何取客户端UserAgent？
**A**：可以通过以下代码取得。需要Form1的OnMouseUp中有代码，一行空注释也可以
```pascal
sIp := dwGetProp(Self,'ua');
```
### Q：DeWeb开发完成后如何部署？
**A**： 直接复制Runtime目录中的所有子目录和文件到服务器，然后运行DeWebServer.exe即可

### Q：如何解决错误：[firedac][Phys][ODBC][Microsoft][odbc sql server driver]连接占线导致另一个hstmt？
**A**：
原因分析：FDQuery.FetchOptions.Mode=fmOnDemand。好像是为了性能问题，不设置则默认先加载50条，  
这样实际上还没有加载完，后面又用了同一个连接再去操作另外一个FDQUERY就会报那个hstmt的错误。  
并不是数据库死锁引起的。
解决办法：
FDQuery.FetchOptions.Mode 设置为fmAll, 返回全部结果。

### Q：在DeWeb中如何自定义多个Edit等的tab顺序？
**A**：通过类似以下设置Hint
{"dwattr":"tabindex='3'"}

### Q：如何通过javascript执行控件（如Form_Show中的Button1）的事件（如onclick）？
**A**：通过类似以下代码实现 
```pascal
    var _DWEVENT := 'this.dwevent('''',''%s'',''%s'',''%s'',''%d'');';
    var sJS := Format(_DWEVENT,['Button1','0','onclick',Form_Show.Handle]);
    dwRunJS(sJS,self);
```

### Q：如何实现类型MessageDlg的弹出式交互对话框？
**A**：有交互的情况需要这样写：

1. 先弹出一个交互框，如dwMessageDlg
   注意： 这里不能直接得到“是”或“否”等结果消息，  
dwMessageDlg没返回值，所以不能在当前函数/过程中处理，  
需要等用户操作后返回结果，自动激活Form的OnStartDock函数，

2. 需要在Form的OnStartDock函数中添加事件，在事件中通过以下取得前期拟触发的事件标志
 首先得到dwGetProp(Self,'interactionmethod');  
  比如dwMessageDlg设置的'query_logout'  
通过类似以下得到返回的结果，为'1'时表示为"确定"，否则为"取消"  
dwGetProp(Self,'interactionvalue');  

### Q：如何在DeWeb中实现批量上传？
**A**：
上传时通过 通过dwUploadMutiple函数  
function  dwUploadMultiple(AForm:TForm;AAccept,ADestDir:String):Integer;  
上传完成后，上传的文件信息以JSON字符串数组的形式保存在窗体的Hint中，如：  

"__uploadsources":["2.png","3.png"],
"__uploadfiles":["20230628_093520496_218.png","20230628_093520497_450.png"]